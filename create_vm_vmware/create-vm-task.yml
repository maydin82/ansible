
- name: Create a VM
  vmware.vmware_rest.vcenter_vm:
  vcenter_rest_log_file: /tmp/vmware_rest
    placement:
      cluster: "{{ lookup('vmware.vmware_rest.cluster_moid', '/' + datacenter + '/host/' + cluster ) }}"
      datastore: "{{ lookup('vmware.vmware_rest.datastore_moid', '/' + datacenter + '/datastore/' + datastore ) }}"
      folder: "{{ lookup('vmware.vmware_rest.folder_moid', '/' + datacenter + '/vm/' + folder ) }}"
    name: "{{ vmname }}"
    guest_OS: RHEL_8_64
    cpu:
      count: 8
      cores_per_socket: 4
      hot_add_enabled: true
      hot_remove_enabled: true
    memory:
      hot_add_enabled: false
      size_MiB: "{{ memory }}"
    disks:
    - type: SCSI
      new_vmdk:
        name: "{{ vmname }}-first_disk"
        capacity: "{{ disk_capacity }}"
    cdroms:
    - type: SATA
      sata:
        bus: 0
        unit: 2
    nics:
    - backing:
        type: DISTRIBUTED_PORTGROUP
        network: "{{ lookup('vmware.vmware_rest.network_moid', '/' + datacenter + '/network /' + network ) }}"
  register: _result


- name: restlog
  shell: cat /tmp/vmware_rest
